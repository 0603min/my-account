    <!DOCTYPE html>
    <html lang="zh-TW">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>2026 Èõ≤Á´ØË®òÂ∏≥Êú¨</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body class="p-5">
        <canvas id="bgCanvas" style="position:fixed; top:0; left:0; z-index:-1; pointer-events:none;"></canvas>
        <div class="loading-bar" id="loadingBar"></div>
        
        <!-- Ê∑±Ëâ≤Ê®°ÂºèÂàáÊèõÊåâÈàï -->
        <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
            üåô
        </button>   

        <div class="max-w-md mx-auto">
            <h1 class="text-3xl font-bold mb-8 text-center gradient-text">üí∞ 2026 Á≤æÁ∑ªË®òÂ∏≥</h1>

            <!-- È§òÈ°çÂç°Áâá -->
            <div class="glass-ui p-8 mb-6 text-center">
                <p class="text-secondary-custom text-sm mb-2">ÁõÆÂâçÈ§òÈ°ç</p>
                <h2 id="balance" class="text-5xl font-bold text-primary-custom balance-animate">$ 0</h2>
            </div>

            <!-- Ëº∏ÂÖ•Ë°®ÂñÆ -->
            <div class="glass-ui p-6 mb-8 space-y-4">
                <input id="desc" type="text" placeholder="‚úèÔ∏è È†ÖÁõÆÂÖßÂÆπ" class="input-style">
                
                <input id="amt" type="number" placeholder="üíµ ÈáëÈ°ç" class="input-style">
                
                <div>
                    <label class="text-xs text-secondary-custom ml-2 mb-1 block">‚è∞ ÁôºÁîüÊôÇÈñì</label>
                    <input id="time" type="datetime-local" class="input-style">
                </div>

                <div class="flex gap-3 pt-2">
                    <button onclick="sendData('income')" class="flex-1 bg-emerald-500 text-white py-4 rounded-2xl font-bold text-lg btn-primary">
                        ‚ú® Â≠òÂÖ•
                    </button>
                    <button onclick="sendData('expense')" class="flex-1 bg-gradient-to-r from-slate-700 to-slate-900 text-white py-4 rounded-2xl font-bold text-lg btn-primary">
                        üí∏ ÊîØÂá∫
                    </button>
                </div>
            </div>

            <!-- Ë®òÈåÑÂàóË°® -->
            <div id="list" class="space-y-4 w-full"></div>
        </div>

        <script>
            const API = 'https://script.google.com/macros/s/AKfycbzLAWeTRW4efS5NHRXrYD9Hd5qZGsBeV7U6IMRf-EOxLPP9IO4cVPjpSzyGntwRjwd1eg/exec'; // <--- Ë´ãÊèõ‰∏ä‰Ω†ÁöÑÁ∂≤ÂùÄ

            // ÂàùÂßãÂåñ‰∏ªÈ°å
            function initTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                updateThemeIcon(savedTheme);
            }

            // ÂàáÊèõ‰∏ªÈ°å
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            }

            // Êõ¥Êñ∞‰∏ªÈ°åÂúñÁ§∫
            function updateThemeIcon(theme) {
                document.getElementById('themeToggle').innerText = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }

            // È†ÅÈù¢ÈñãÂïüÊôÇÂÅö‰∏â‰ª∂‰∫ãÔºöÂàùÂßãÂåñ‰∏ªÈ°å„ÄÅË®≠ÂÆöÈ†êË®≠ÊôÇÈñì„ÄÅÊäìË≥áÊñô
            window.onload = () => {
                initTheme();
                setDefaultTime();
                fetchData();
            };

            // Ë®≠ÂÆö„ÄåÁï∂‰∏ãÊôÇÈñì„ÄçÂà∞Ëº∏ÂÖ•Ê°Ü
            function setDefaultTime() {
                const now = new Date();
                const offset = now.getTimezoneOffset() * 60000;
                const localISOTime = (new Date(now - offset)).toISOString().slice(0, 16);
                document.getElementById('time').value = localISOTime;
            }

            async function fetchData() {
                showLoading(true);
                try {
                    const res = await fetch(API);
                    const data = await res.json();
                    let b = 0;
                    document.getElementById('list').innerHTML = data.reverse().map((i, index) => {
                        const isInc = i.type === 'income';
                        b += isInc ? Number(i.amount) : -Number(i.amount);
                        const dateObj = new Date(i.date);
                        const timeStr = dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        return `
                            <div class="glass-ui p-5 flex justify-between items-center list-item" style="animation-delay: ${index * 0.05}s">
                                <div>
                                    <p class="font-bold text-primary-custom text-lg">${i.desc}</p>
                                    <p class="text-xs text-secondary-custom mt-1">üìÖ ${timeStr}</p>
                                </div>
                                <span class="${isInc?'text-emerald-500':'text-rose-500'} font-bold text-xl">
                                    ${isInc?'+':'-'}$${Number(i.amount).toLocaleString()}
                                </span>
                            </div>`;
                    }).join('');
                    
                    const balanceEl = document.getElementById('balance');
                    balanceEl.innerText = `$ ${b.toLocaleString()}`;
                    balanceEl.classList.add('balance-animate');
                    setTimeout(() => balanceEl.classList.remove('balance-animate'), 500);
                } catch (error) {
                    console.error('ËºâÂÖ•Â§±Êïó:', error);
                }
                showLoading(false);
            }

            async function sendData(type) {
                const desc = document.getElementById('desc').value;
                const amount = document.getElementById('amt').value;
                const time = document.getElementById('time').value;

                if(!desc || !amount || !time) {
                    alert('Ë´ãÂÆåÊï¥Â°´ÂØ´Ë≥áË®ä üìù');
                    return;
                }

                showLoading(true);
                
                try {
                    await fetch(API, { 
                        method: 'POST', 
                        body: JSON.stringify({ 
                            desc: desc, 
                            amount: Number(amount), 
                            type: type,
                            customDate: time
                        }) 
                    });
                    
                    location.reload();
                } catch (error) {
                    console.error('ÈÄÅÂá∫Â§±Êïó:', error);
                    showLoading(false);
                }
            }

            // ËºâÂÖ•ÈÄ≤Â∫¶Ê¢ù
            function showLoading(show) {
                const bar = document.getElementById('loadingBar');
                if (show) {
                    bar.style.width = '70%';
                    document.body.style.opacity = '0.7';
                } else {
                    bar.style.width = '100%';
                    setTimeout(() => {
                        bar.style.width = '0';
                        document.body.style.opacity = '1';
                    }, 300);
                }
            }
        </script>
    </body>
    </html>