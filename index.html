<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ 2026 é›²ç«¯å¸³æœ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); min-height: 100vh; }
        .glass-ui { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-radius: 24px; border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 8px 32px rgba(0,0,0,0.05); }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 999; justify-content: center; align-items: center; flex-direction: column; }
        .btn-active:active { transform: scale(0.95); }
    </style>
</head>
<body class="p-4 md:p-10">

    <div id="loader" class="loading-overlay">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"></div>
        <p class="text-indigo-600 font-bold">é›²ç«¯åŒæ­¥ä¸­...</p>
    </div>

    <div class="max-w-md mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">2026 å¸³æœ¬</h1>
                <p class="text-gray-400 text-sm">æ•¸æ“šå„²å­˜æ–¼ Google é›²ç«¯</p>
            </div>
            <button onclick="fetchData()" class="p-2 bg-white rounded-full shadow-sm hover:rotate-180 transition-transform duration-500">
                ğŸ”„
            </button>
        </header>

        <div class="glass-ui p-6 mb-6">
            <div class="text-center mb-6">
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">ç›®å‰ç¸½è³‡ç”¢</p>
                <h2 id="balance" class="text-4xl font-black text-gray-800 mt-1">$ 0</h2>
            </div>
            <div class="flex justify-around pt-4 border-t border-gray-100">
                <div class="text-center">
                    <p class="text-xs text-emerald-500 font-bold">ç¸½æ”¶å…¥</p>
                    <p id="income" class="text-lg font-bold text-gray-700">$ 0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-rose-500 font-bold">ç¸½æ”¯å‡º</p>
                    <p id="expense" class="text-lg font-bold text-gray-700">$ 0</p>
                </div>
            </div>
        </div>

        <div class="glass-ui p-6 mb-8">
            <div class="space-y-4">
                <input id="desc" type="text" placeholder="é …ç›®åç¨± (å¦‚ï¼šæ™šé¤)" class="w-full p-4 bg-gray-50 border-none rounded-2xl outline-none focus:ring-2 ring-indigo-400 transition-all">
                <input id="amount" type="number" inputmode="numeric" placeholder="é‡‘é¡" class="w-full p-4 bg-gray-50 border-none rounded-2xl outline-none focus:ring-2 ring-indigo-400 transition-all">
                <div class="flex gap-4">
                    <button onclick="sendData('income')" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-indigo-100 btn-active">å­˜å…¥</button>
                    <button onclick="sendData('expense')" class="flex-1 bg-gray-800 text-white py-4 rounded-2xl font-bold shadow-lg shadow-gray-200 btn-active">æ”¯å‡º</button>
                </div>
            </div>
        </div>

        <h3 class="font-bold text-gray-700 mb-4 px-2 flex items-center">
            <span class="mr-2">ğŸ“…</span> æœ€è¿‘äº¤æ˜“ç´€éŒ„
        </h3>
        <div id="list" class="space-y-3">
            </div>
    </div>

    <script>
        // é€™æ˜¯ä½ å°ˆå±¬çš„ Google Apps Script ç¶²å€
        const API_URL = 'https://script.google.com/macros/s/AKfycbyrpe7TTYrmK1SL0ar8UDyiuB4nBgA8Y_3-PqzJBVjHz4rFvqEi2rG0b6VERliDfpmbgw/exec';

        // é é¢é–‹å•Ÿæ™‚è‡ªå‹•æŠ“å–è³‡æ–™
        window.onload = fetchData;

        async function fetchData() {
            toggleLoader(true);
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                render(data);
            } catch (e) {
                console.error(e);
                alert("æŠ“å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¢ºèª Google è©¦ç®—è¡¨æ¬Šé™å·²è¨­ç‚ºã€Œæ‰€æœ‰äººã€ï¼");
            }
            toggleLoader(false);
        }

        async function sendData(type) {
            const desc = document.getElementById('desc').value;
            const amount = parseFloat(document.getElementById('amount').value);

            if (!desc || isNaN(amount)) return alert("è«‹å®Œæ•´è¼¸å…¥å…§å®¹èˆ‡é‡‘é¡å”·ï¼");

            toggleLoader(true);
            try {
                // ç™¼é€è³‡æ–™åˆ° Google Sheets
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ desc, amount, type })
                });

                // æ¸…ç©ºè¼¸å…¥æ¡†
                document.getElementById('desc').value = '';
                document.getElementById('amount').value = '';
                
                // é‡æ–°è®€å–è³‡æ–™
                await fetchData();
            } catch (e) {
                alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            }
            toggleLoader(false);
        }

        function render(data) {
            const list = document.getElementById('list');
            const balEl = document.getElementById('balance');
            const incEl = document.getElementById('income');
            const expEl = document.getElementById('expense');

            let bal = 0, inc = 0, exp = 0;
            list.innerHTML = '';

            // å°‡è³‡æ–™åè½‰ï¼Œè®“æœ€æ–°çš„æ’åœ¨ä¸Šé¢
            data.reverse().forEach(item => {
                const amt = parseFloat(item.amount);
                if (item.type === 'income') { inc += amt; bal += amt; }
                else { exp += amt; bal -= amt; }

                const div = document.createElement('div');
                div.className = 'glass-ui p-4 flex justify-between items-center animate-fade-in';
                div.innerHTML = `
                    <div>
                        <p class="font-bold text-gray-800">${item.desc}</p>
                        <p class="text-[10px] text-gray-400 font-medium">${new Date(item.date).toLocaleDateString()} ${new Date(item.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                    </div>
                    <span class="font-bold ${item.type === 'income' ? 'text-emerald-500' : 'text-rose-500'}">
                        ${item.type === 'income' ? '+' : '-'}$ ${amt.toLocaleString()}
                    </span>
                `;
                list.appendChild(div);
            });

            balEl.innerText = `$ ${bal.toLocaleString()}`;
            incEl.innerText = `$ ${inc.toLocaleString()}`;
            expEl.innerText = `$ ${exp.toLocaleString()}`;
        }

        function toggleLoader(show) {
            document.getElementById('loader').style.display = show ? 'flex' : 'none';
        }
    </script>
</body>
</html>